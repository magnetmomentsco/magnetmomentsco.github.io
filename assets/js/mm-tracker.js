!function(){"use strict";var e={apiKey:"__FIREBASE_API_KEY__",authDomain:"__FIREBASE_AUTH_DOMAIN__",databaseURL:"__FIREBASE_DATABASE_URL__",projectId:"magnetmomentsco-us",storageBucket:"__FIREBASE_STORAGE_BUCKET__",messagingSenderId:"__FIREBASE_MESSAGING_SENDER_ID__",appId:"__FIREBASE_APP_ID__"},t=5,n=10;function a(){return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function r(){return(new Date).toISOString()}function i(e,t){return e?e.length>t?e.substring(0,t):e:""}function o(){var e=window.innerWidth||screen.width;return e<768?"mobile":e<1024?"tablet":"desktop"}function s(e){if("cpc"===e.medium||"ppc"===e.medium||"paid"===e.medium)return"paid";if(e.source)return"referral";var t,n=document.referrer;if(!n)return"direct";try{t=new URL(n).hostname}catch(e){return"direct"}if(t===location.hostname)return"direct";if(/google\.|bing\.|yahoo\.|duckduckgo\.|baidu\.|yandex\./i.test(t))return"organic";return/facebook\.|instagram\.|twitter\.|x\.com|tiktok\.|pinterest\.|linkedin\.|youtube\.|threads\.net|reddit\./i.test(t)?"social":"referral"}var c,d,u={visitorId:null,sessionId:null,sessionStart:null,pagesViewed:0,intentScore:0,slug:(d||location.pathname).replace(/^\/|\/$/g,"").replace(/\//g,"-").replace(/[.#$\[\]]/g,"-")||"home",date:(c=new Date,c.getFullYear()+"-"+String(c.getMonth()+1).padStart(2,"0")+"-"+String(c.getDate()).padStart(2,"0")),dnt:!1,isAdmin:!1,fbReady:!1,db:null,batchQueue:[],scrollFired:{}};function l(e){return new Promise(function(t,n){if(document.querySelector('script[src="'+e+'"]'))t();else{var a=document.createElement("script");a.src=e,a.async=!0,a.onload=t,a.onerror=function(){n(new Error("Failed to load "+e))},document.head.appendChild(a)}})}function m(e){return u.db.ref(e)}function p(e,t){return m(e).set(t)}function f(e){u.batchQueue.push(e)}function h(){if(u.fbReady&&0!==u.batchQueue.length){var e=u.batchQueue.splice(0),t={},n={},a=[];e.forEach(function(e){"increment"===e.type?n[e.path]=(n[e.path]||0)+1:a.push(e)}),Object.keys(n).forEach(function(e){t[e]=firebase.database.ServerValue.increment(n[e])}),a.forEach(function(e){if("push"===e.type){var n=m(e.path).push().key;t[e.path+"/"+n]=e.data}else"set"===e.type&&(t[e.path]=e.data)}),Object.keys(t).length&&u.db.ref().update(t)}}function g(){if(!u.dnt){var e,t={source:(e=new URLSearchParams(location.search)).get("utm_source")||null,medium:e.get("utm_medium")||null,campaign:e.get("utm_campaign")||null,content:e.get("utm_content")||null,term:e.get("utm_term")||null},n={url:location.href,path:location.pathname,title:document.title,referrer:document.referrer||null,timestamp:r(),sessionId:u.sessionId,visitorId:u.visitorId,device:o(),utm:t,source:s(t)};f({type:"push",path:"/pageViews/"+u.date+"/"+u.slug,data:n}),function(e){m(e).set(firebase.database.ServerValue.increment(1))}("/productViewCounts/"+u.date+"/"+u.slug),_(1)}}function v(){if(!u.dnt){u.scrollFired={};var e,t,n,a=[25,50,75,100],r=(e=function(){var e=window.pageYOffset||document.documentElement.scrollTop,t=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight)-window.innerHeight;if(!(t<=0)){var n=Math.round(e/t*100);a.forEach(function(e){n>=e&&!u.scrollFired[e]&&(u.scrollFired[e]=!0,f({type:"increment",path:"/scrollDepth/"+u.date+"/"+u.slug+"/"+e}),e>=75&&_(2))})}},t=250,function(){var a=this,r=arguments;clearTimeout(n),n=setTimeout(function(){e.apply(a,r)},t)});window.addEventListener("scroll",r,{passive:!0})}}var y={clicks:[],timer:null};function b(){if(!u.dnt){var e,t,n,a=(e=function(e){var t=e.target||{},n=window.innerWidth||1,a=window.innerHeight||1,o={x:Math.round(e.clientX/n*1e4)/100,y:Math.round(e.clientY/a*1e4)/100,tag:(t.tagName||"").toLowerCase(),cls:i(t.className||"",100),id:t.id||null,text:i((t.textContent||"").trim(),50),ts:r()};f({type:"push",path:"/clicks/"+u.date+"/"+u.slug,data:o}),function(e,t){var n=Date.now();if(y.clicks.push({x:e,y:t,t:n}),y.clicks=y.clicks.filter(function(e){return n-e.t<500}),y.clicks.length>=3){var a=y.clicks[0];y.clicks.every(function(e){var t=e.x-a.x,n=e.y-a.y;return Math.sqrt(t*t+n*n)<=50})&&(f({type:"push",path:"/rageClicks/"+u.date+"/"+u.slug,data:{x:a.x,y:a.y,count:y.clicks.length,ts:r()}}),y.clicks=[])}}(e.clientX,e.clientY)},t=200,n=0,function(){var a=Date.now();a-n>=t&&(n=a,e.apply(this,arguments))});document.addEventListener("click",a,!0)}}function w(e){var t=e&&e.closest?e.closest(".product-card"):null;if(t){var n=t.querySelector(".product-card-link");if(n){var a=(n.getAttribute("href")||"").match(/\/shop\/([^\/]+)/);if(a)return a[1]}}var r=location.pathname.match(/\/shop\/([^\/]+)/);return r?r[1]:"unknown"}function S(e,t,n){f({type:"increment",path:"/funnel/"+u.date+"/"+e+"/"+t}),n&&_(n)}function I(){if(!u.dnt){var e=function(){var e={};if(window.performance&&performance.getEntriesByType){var t=performance.getEntriesByType("navigation")[0];t&&(e.pageLoad=Math.round(t.loadEventEnd-t.startTime),e.domContentLoaded=Math.round(t.domContentLoadedEventEnd-t.startTime),e.ttfb=Math.round(t.responseStart-t.requestStart))}try{!function(e){if(PerformanceObserver.supportedEntryTypes&&-1!==PerformanceObserver.supportedEntryTypes.indexOf("paint")){performance.getEntriesByType("paint").forEach(function(t){"first-contentful-paint"===t.name&&(e.fcp=Math.round(t.startTime))})}try{new PerformanceObserver(function(t){var n=t.getEntries();n.length&&(e.lcp=Math.round(n[n.length-1].startTime))}).observe({type:"largest-contentful-paint",buffered:!0})}catch(e){}try{var t=0;new PerformanceObserver(function(n){n.getEntries().forEach(function(e){e.hadRecentInput||(t+=e.value)}),e.cls=Math.round(1e3*t)/1e3}).observe({type:"layout-shift",buffered:!0})}catch(e){}try{new PerformanceObserver(function(t){var n=t.getEntries();n.length&&(e.fid=Math.round(n[0].processingStart-n[0].startTime))}).observe({type:"first-input",buffered:!0})}catch(e){}try{var n=0;new PerformanceObserver(function(t){t.getEntries().forEach(function(e){var t=e.duration;t>n&&(n=t)}),e.inp=Math.round(n)}).observe({type:"event",buffered:!0,durationThreshold:16})}catch(e){}}(e)}catch(e){}setTimeout(function(){var t;e.device=o(),e.connection=(t=navigator.connection||navigator.mozConnection||navigator.webkitConnection)&&(t.effectiveType||t.type)||"unknown",e.timestamp=r(),e.url=location.pathname,f({type:"push",path:"/performance/"+u.date+"/"+u.slug,data:e})},3e3)};"complete"===document.readyState?e():window.addEventListener("load",e)}}function E(e){return function(e){for(var t=2166136261,n=0;n<e.length;n++)t^=e.charCodeAt(n),t=Math.imul(t,16777619);return t>>>0}(u.visitorId+":"+e)%2==0?"A":"B"}function _(e){u.intentScore+=e;try{localStorage.setItem("mm_intent",String(u.intentScore))}catch(e){}k()}function k(){if(!u.dnt&&u.fbReady){var e="low";u.intentScore>=n?e="high":u.intentScore>=t&&(e="medium"),p("/visitors/"+u.visitorId+"/intent",{score:u.intentScore,level:e,updatedAt:r()})}}window.MMTracker={track:function(e,t){u.dnt||f({type:"push",path:"/events/"+u.date+"/"+e,data:Object.assign({},t||{},{visitorId:u.visitorId,sessionId:u.sessionId,page:location.pathname,timestamp:r()})})},getVariant:E,getProductViews:function e(t){if(!u.fbReady)return new Promise(function(n){document.addEventListener("mm:tracker-ready",function(){n(e(t))},{once:!0})});var n="shop-"+t;return m("/productViewCounts/"+u.date+"/"+n).once("value").then(function(e){return e.val()||0})}};setInterval(h,3e4);document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&h()}),window.addEventListener("pagehide",function(){if(!u.dnt&&u.fbReady){var t=Math.round((Date.now()-u.sessionStart)/1e3);p("/sessions/"+u.date+"/"+u.sessionId,{visitorId:u.visitorId,duration:t,pages:u.pagesViewed,device:o(),endedAt:r()})}h(),function(){if(u.fbReady&&0!==u.batchQueue.length){var t=u.batchQueue.splice(0),n={},a={};if(t.forEach(function(e){if("increment"===e.type)a[e.path]=(a[e.path]||0)+1;else if("push"===e.type){var t="bc_"+Date.now()+"_"+Math.random().toString(36).substring(2,8);n[e.path+"/"+t]=e.data}else"set"===e.type&&(n[e.path]=e.data)}),Object.keys(a).forEach(function(e){n[e]={".sv":{increment:a[e]}}}),Object.keys(n).length){var r=e.databaseURL+"/.json",i=new Blob([JSON.stringify(n)],{type:"application/json"});try{navigator.sendBeacon(r,i)}catch(e){}}}}()}),function(){var e=null;try{e=localStorage.getItem("mm_vid")}catch(e){}if(e)u.visitorId=e;else{u.visitorId=a();try{localStorage.setItem("mm_vid",u.visitorId)}catch(e){}}}(),function(){var e=null;try{e=sessionStorage.getItem("mm_sid")}catch(e){}if(e)u.sessionId=e,u.sessionStart=Number(sessionStorage.getItem("mm_sstart"))||Date.now(),u.pagesViewed=Number(sessionStorage.getItem("mm_spv"))||0;else{u.sessionId=a(),u.sessionStart=Date.now(),u.pagesViewed=0;try{sessionStorage.setItem("mm_sid",u.sessionId),sessionStorage.setItem("mm_sstart",String(u.sessionStart))}catch(e){}}u.pagesViewed++;try{sessionStorage.setItem("mm_spv",String(u.pagesViewed))}catch(e){}}(),function(){try{u.intentScore=Number(localStorage.getItem("mm_intent"))||0}catch(e){}}(),/^\/admin\//i.test(location.pathname)&&(u.isAdmin=!0),"1"!==navigator.doNotTrack&&"1"!==window.doNotTrack||(u.dnt=!0),u.isAdmin||u.dnt||(window.addEventListener("error",function(e){e.target&&"IMG"===e.target.tagName?f({type:"push",path:"/errors/"+u.date,data:{kind:"image",src:e.target.src||e.target.currentSrc||null,page:location.pathname,timestamp:r()}}):f({type:"push",path:"/errors/"+u.date,data:{kind:"runtime",message:i(e.message||"",500),source:e.filename||null,line:e.lineno||null,col:e.colno||null,stack:i(e.error&&e.error.stack||"",1e3),page:location.pathname,timestamp:r()}})},!0),window.addEventListener("unhandledrejection",function(e){var t=e.reason||{};f({type:"push",path:"/errors/"+u.date,data:{kind:"promise",message:i(String(t.message||t),500),stack:i(String(t.stack||""),1e3),page:location.pathname,timestamp:r()}})})),l("https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js").then(function(){return l("https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js")}).then(function(){firebase.apps.length||firebase.initializeApp(e),u.db=firebase.database(),u.fbReady=!0,document.dispatchEvent(new CustomEvent("mm:tracker-ready"))}).then(function(){u.isAdmin||(g(),function(){if(!u.dnt&&u.fbReady){var e=m("/presence/"+u.visitorId),t=m(".info/connected"),n={page:location.pathname,slug:u.slug,device:o(),timestamp:firebase.database.ServerValue.TIMESTAMP};t.on("value",function(t){!0===t.val()&&(e.set(n),u.presenceInterval&&clearInterval(u.presenceInterval),u.presenceInterval=setInterval(function(){e.update({timestamp:firebase.database.ServerValue.TIMESTAMP})},6e4))})}}(),v(),b(),function(){if(!u.dnt){var e={};document.addEventListener("mouseover",function(t){var n=t.target.closest?t.target.closest(".product-card"):null;if(n){var a=w(n);e[a]||(e[a]=!0,S("product-card-hover",a,0))}}),/^\/shop\/[^\/]+/.test(location.pathname)&&document.querySelector(".pdp")&&(S("product-view",w(null),3),_(2)),document.addEventListener("click",function(e){e.target.closest&&e.target.closest(".pdp-thumb")&&S("image-browse",w(null),0)}),document.addEventListener("mm:add-to-cart",function(e){S("add-to-cart",(e&&e.detail||{}).productHandle||w(null),5)}),document.addEventListener("mm:checkout-start",function(){S("checkout-start","all",0)})}}(),u.dnt||["mm:popup-shown","mm:popup-dismissed","mm:popup-submitted"].forEach(function(e){document.addEventListener(e,function(t){var n=e.replace("mm:","").replace(/-/g,"_");f({type:"increment",path:"/newsletter/"+u.date+"/"+n}),"mm:popup-dismissed"===e&&t.detail&&t.detail.method&&f({type:"push",path:"/newsletter/"+u.date+"/dismiss_details",data:{method:t.detail.method,ts:r()}})})}),u.dnt||document.addEventListener("mm:cart-update",function(e){var t=e&&e.detail||{};f({type:"push",path:"/cart/"+u.date,data:{action:t.action||"unknown",items:t.items||null,total:t.total||null,visitorId:u.visitorId,sessionId:u.sessionId,timestamp:r()}})}),I(),function(){if(!u.dnt){var e,t="mm_time_intent_"+u.sessionId;try{e=sessionStorage.getItem(t)}catch(e){}e||setTimeout(function(){try{sessionStorage.setItem(t,"1")}catch(e){}_(2)},6e4)}}(),function(){if(!u.dnt){var e;try{e=localStorage.getItem("mm_experiments")}catch(e){return}if(e){var t;try{t=JSON.parse(e)}catch(e){return}Array.isArray(t)&&t.forEach(function(e){f({type:"increment",path:"/abTests/"+e+"/"+E(e)+"/views"})})}}}(),u.dnt||k())}).catch(function(e){"undefined"!=typeof console&&console.warn&&console.warn("[MMTracker] Firebase init failed:",e)})}();